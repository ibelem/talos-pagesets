jQuery.fn.imageZoom=function(q){var r=jQuery.extend({speed:150,dontFadeIn:1,hideClicked:1,imageMargin:15,className:'jquery-image-zoom',loaddisableding:'Loading...'},q);r.doubleSpeed=r.speed/4;return this.click(function(e){var k=jQuery(e.target);var l=k.is('a')?k:k.parents('a');l=(l&&l.is('a')&&l.attr('href').search(/(.*)\.(jpg|jpeg|gif|png|bmp|tif|tiff)$/gi)!=-1)?l:false;var m=(l&&l.find('img').length)?l.find('img'):false;if(l){l.oldText=l.text();l.setLoadingImg=function(){if(m){m.css({opacity:'0.5'})}else{l.text(r.loaddisableding)}};l.setNotLoadingImg=function(){if(m){m.css({opacity:'1'})}else{l.text(l.oldText)}};var n=l.attr('href');if(jQuery('div.'+r.className+' img[src="'+n+'"]').length){return false}var o=new Image();o.src=n;var p=function(){l.setNotLoadingImg();var a=m?m:l;var b=m?r.hideClicked:0;var c=a.offset();var d={width:a.outerWidth(),height:a.outerHeight(),left:c.left,top:c.top};var e=jQuery('<div><img src="'+n+'" alt="" /></div>').css('position','absolute').appendTo(document.body);var f={width:o.width,height:o.height};var g={width:jQuery(window).width(),height:jQuery(window).height()};if(f.width>(g.width-r.imageMargin*2)){var h=g.width-r.imageMargin*2;f.height=(h/f.width)*f.height;f.width=h}f.left=(g.width-f.width)/2+jQuery(window).scrollLeft();f.top=(g.height-f.height)/2+jQuery(window).scrollTop();var i=jQuery('<a href="#">Close</a>').appendTo(e).hide();if(f.top<0)f.top=20;if(b){l.css('visibility','hidden')}e.addClass(r.className).css(d).animate(f,r.speed,function(){i.fadeIn(r.doubleSpeed)});var j=function(){i.fadeOut(r.doubleSpeed,function(){e.animate(d,r.speed,function(){l.css('visibility','visible');e.remove()})});return false};e.click(j);i.click(j)};if(o.complete){p()}else{l.setLoadingImg();o.onloaddisabled=p}return false}})};$(document).keydown(function(e){if(e.keyCode==27){$('div.jquery-image-zoom a').click()}});