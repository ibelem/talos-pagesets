(function(c){jQuery.widget("ui.rating",{options:{widgetClass:"rating",errorMessage:"Oops! Please try again later.",ajaxURL:"/ratings/_ajax/title",starWidth:14,uconst:undefined,redirectURL:"/register/?why=vote"},_create:function(){function h(b){if(a.options.uconst){l();a.$cancel.removeClass("rating-hover").addClass("rating-pending");a.pendingRating=b;c.ajax({url:a.options.ajaxURL,type:"POST",dataType:"json",data:{tconst:a.tconst,rating:a.pendingRating,auth:a.authKey,tracking_tag:a.trackingTag},error:function(){return i()},
success:function(d){if(d.status!=200)return i();if(a.pendingRating==0){a.originalRating=a.imdbRating;a.state="imdb"}else{a.originalRating=a.pendingRating;a.state="your"}d=a.pendingRating;a.pendingRating=undefined;a.$stars.removeClass("rating-hover");a.$caption.removeClass("rating-hover");a.$cancel.removeClass("rating-pending");j();m();c(a.element).trigger("change.rating",{rating:d,tconst:a.tconst})}})}else{b=c("#nblogin");if(b.size()==0)document.location=a.options.redirectURL;else b.trigger("click")}}
function j(){a.$stars.removeClass("rating-hover");a.$caption.removeClass("rating-hover");a.$cancel.removeClass("rating-hover");if(a.state=="your"){a.$stars.slice(0,a.originalRating).addClass("rating-your");a.$caption.addClass("rating-your");a.$cancel.addClass("rating-your")}else{a.$stars.removeClass("rating-your");a.$caption.removeClass("rating-your");a.$cancel.removeClass("rating-your");a.$imdb.show()}k(a.originalRating)}function k(b){a.$caption[0].firstChild.data=b||"-"}function i(){a.element.addClass("rating-error");
a.element.html('<span class="rating-error-icon">&nbsp;</span><span class="rating-error-text">'+a.options.errorMessage+"</span>");return false}function l(){a.=true}function m(){a.=false}function n(b){var d=b.element[0].id.split("|"),o=d[1],p=d[2],g=b.options.starWidth;jQuery(".rating-ineligible",b.element).append('<img src="'+b.options.images.info+'">');jQuery(".rating-imdb",b.element).remove();var q=o=="imdb"?b.options.images.imdb:b.options.images.your;jQuery(".rating-stars a",b.element).each(function(e){e=
e+1;e='<a href="'+jQuery(this).attr("href")+'"><img width='+g+" height="+g+' src="'+(e<=p?q:b.options.images.off)+'"></a>';jQuery(this).replaceWith(e)});jQuery(".rating-cancel a",b.element).html("<img width="+g+" height="+g+' src="'+b.options.images.del+'"></a>')}var a=this;if(jQuery.browser.msie&&jQuery.browser.version<7)return n(a);var f=a.element[0].id.split("|");a.tconst=f[0];a.state=a.originalState=f[1];a.originalRating=f[2];a.imdbRating=f[3];a.trackingTag=f[4]||"";a.=false;a.$stars=
c(".rating-stars a",a.element);a.$imdb=c(".rating-imdb",a.element);a.$cancel=c(".rating-cancel",a.element);a.$caption=c(".rating-rating",a.element);a.$stars.removeAttr("href");c("a",a.$cancel).removeAttr("href");a.authKey=c(a.element).attr("data-auth");a.$stars.bind("mouseover.rating",function(){if(a.)return false;var b=a.$stars.index(this)+1;a.state=="your"?a.$stars.removeClass("rating-your"):a.$imdb.hide();a.$stars.slice(0,b).addClass("rating-hover");a.$stars.slice(b+1).removeClass("rating-hover");
a.$caption.addClass("rating-hover");a.$cancel.addClass("rating-hover");k(b)}).bind("mouseout.rating",function(){if(a.)return false;j()}).bind("click.rating",function(){if(a.)return false;h(a.$stars.index(this)+1)});a.$cancel.bind("click.rating",function(){if(a.)return false;h(0)})}});c.extend(c.ui.rating,{version:"2.0"})})(jQuery);
