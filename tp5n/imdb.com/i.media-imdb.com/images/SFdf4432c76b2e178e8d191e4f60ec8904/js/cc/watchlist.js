(function(a){jQuery.widget("ui.watchlist_listener",{options:{doLogin:true,confirmAccount:false,hasWatchlist:false},_init:function(){function k(){var e=a(document);if(!e.data("wl_init")){g=a();e.data("wl_init",true).data("void",g).delegate(".add_to_watchlist a","click",function(){if(j.doLogin)a("#nblogin").click();else if(j.confirmAccount)window.location="/register-imdb/";else{var b=a(this);if(!b.hasClass("")){var c=b.closest(".add_to_watchlist");if(b.hasClass("wl_lists_btn"))c.hasClass(void")?
c.trigger("close"):c.trigger(void");else if(b.hasClass("in_wl")){c.trigger("close");document.location="/list/watchlist"}else c.trigger("add");return false}}}).delegate(".wl_lists_btn","mouseenter",function(){l(a(this).closest(".add_to_watchlist"))}).click(function(b){if(g.size()!=0){b=a(b.target).closest(".add_to_watchlist");g.not(b).trigger("close")}}).delegate(".add_to_watchlist",void",function(){var b=a(this);b.addClass(void");g=g.add(b);a(".wl_lists_btn",b).html("&#x25b2;");a(".wl-menu",b).show()}).delegate(".add_to_watchlist",
"close",function(){var b=a(this);b.removeClass(void");g=g.not(b);a(".wl_lists_btn",b).html("&#x25bc;");a(".wl-menu",b).hide()}).delegate(".add_to_watchlist","add",function(){var b=a(this),c=b.attr("data-const"),f=b.attr("data-lcn");b.trigger("close");var d=i[c],h=a("a",d).addClass("").filter(".wl_action_btn").html("<span>&nbsp;</span>Adding...").addClass("pending");a.ajax({url:"/list/_ajax/watchlist_add",type:"POST",data:{tconst:c,lcn:f},error:function(){h.html("Error").addClass("error")},
success:function(m){if(m.status==200){h.html("<span>&nbsp;</span> In <u>Watchlist</u>").addClass("in_wl");a("a",d).removeClass(" pending");d.trigger("watchlist.added")}else h.html("Couldn't add")}})}).bind("wl_add",function(b,c){n(c)})}}function n(e){var b=[],c=a();e.each(function(f,d){f=a(d);if(!f.data("wl_init")){d=f.attr("data-const");i[d]=i[d]||a();i[d]=i[d].add(f);b.push(d);c=c.add(f);f.data("wl_init",true)}});if(j.hasWatchlist)c.size()>0&&a.ajax({url:"/list/_ajax/watchlist_has",type:"POST",
data:{consts:b},error:function(){},success:function(f){if(f.status==200){c.each(function(d,h){d=a(h);h=d.attr("data-const");f.has[h]?a(".wl_action_btn",d).html("<span>&nbsp;</span> In <u>Watchlist</u>").addClass("in_wl"):a(".wl_action_btn",d).html("Add to Watchlist")});a("a",c).removeClass("")}}});else{a(".wl_action_btn",c).html("Add to Watchlist");a("a",c).removeClass("")}}function l(e){if(!(a(".wl-lists",e).size()>0||e.data("wl-list")=="pending")){e.data("wl-list","pending");a.ajax({url:"/list/_ajax/wl_lists",
data:{tconst:e.attr("data-const")},error:function(){},success:function(b){if(b.status==200){a(".wl-menu",e).html(b.lists);e.data("wl-list",undefined)}}})}}var g,j=this.options,i=[];k()},version:"2,0"})})(jQuery);
