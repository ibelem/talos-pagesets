(function(a){namespace("MySpace.Bunchball.Nitro");MySpace.Bunchball.Nitro.RuleType={AND:0,OR:1};MySpace.Bunchball.Nitro.MakeApiCall=function(d,c,b,e){if(!this.initialized){this.Initialize()}if(e&&!this.ConnectionInfo.SessionKey){if(this.retryTries>0){this.retryTries--;var f=this;setTimeout(function(){f.MakeApiCall(d,c,b,e)},this.retryInterval)}return}c.sessionKey=this.ConnectionInfo.SessionKey;c.method=d;c.locale=MySpaceClientContext.PreferredCulture;a.ajax({type:"GET",url:this.ConnectionInfo.Server,data:c,dataType:"jsonp",jsonp:"jsCallback",success:function(g){if(g.Nitro.res==="ok"){b(g.Nitro)}}})};MySpace.Bunchball.Nitro.FilterBadgesByTags=function(b,d){var c=new Array();a.each(b,function(f,e){a.each(d,function(g,h){if(e.Tags[h]){c.push(e);return false}})});return c};MySpace.Bunchball.Nitro.GetBadges=function(e,b,c){var d=this;this.MakeApiCall("user.getChallengeProgress",{userId:e},function(g){if(b){var f=d.CreateBadgeListFromNitroResponse(g);if(c){f=d.FilterBadgesByTags(f,c)}b(f)}},true)};MySpace.Bunchball.Nitro.GetRecentBadges=function(c,b){this.GetBadges(c,function(d){if(b){var e=new Array();var g=d.length;a.each(d,function(i,h){if(h.IsAchieved){e.push(h)}});var f=e.sort(function(h,i){return i.CompletionTime-h.CompletionTime});b({badges:f,totalBadges:g})}})};MySpace.Bunchball.Nitro.GetNextSuggestedBadge=function(d,b){var c=this;this.MakeApiCall("user.getNextChallenge",{userId:d},function(f){if(b){var e=c.CreateBadgeListFromNitroResponse(f);b(e[0])}},true)};MySpace.Bunchball.Nitro.CreateBadgeListFromNitroResponse=function(g){function e(h,l){var n=(h.description||"").split("|",2);var o=n[0];var k=n[1]?n[1]:o;var m=l&&(MySpaceClientContext.DisplayFriendId===MySpaceClientContext.UserId);var i=m?k:o;var j=a("<span />").html(i);j.find(".cta").attr("href",h.actionUrl);return j.html()}function c(h){var l=h.completionCount>0;var j=h.startTime>0&&new Date(h.startTime*1000)>new Date();var i=h.endTime>0&&new Date(h.endTime*1000)<new Date();var k=h.hideUntilEarned==="1";return l||!(j||i||k)}function f(h){var m=new Object();var k=h.tags.split(",");for(var j=0;j<k.length;++j){var l=k[j];m[l]=l}return m}var b=new Array();if(g.challenges!==true){var d=(typeof g.challenges.Challenge[0]==="undefined")?g.challenges:g.challenges.Challenge;a.each(d,function(m,h){if(!c(h)){return true}var r=new Array();var i=(typeof h.rules.Rule[0]==="undefined")?h.rules:h.rules.Rule;var s=0;a.each(i,function(v,x){var w={Goal:x.goal,Progress:x.achieved,IsCompleted:x.completed==="true",Description:x.description||""};if(w.IsCompleted){s+=1}r.push(w)});var n=h.completionCount>0;var p=0;if(n){p=100}else{if(r.length===1){var q=r[0];p=(q.Progress/q.Goal)*100}else{if(r.length>1){p=(s/r.length)*100}}}p=Math.min(Math.ceil(p),100);var l=e(h,n);var j=h.dateCompleted?new Date(h.dateCompleted*1000):null;var k=(h.customData||"").split("|");var o=k[0];var u=k[1]||h.name;var t=f(h);b.push({Name:h.name,Description:l,IsAchieved:n,PercentComplete:p,InProgress:p>0&&p<100,IsLimitedEdition:h.endTime>0,ThumbUrl:h.thumbUrl,FullUrl:h.fullUrl,IconUrl:h.iconUrl,LockedUrl:o,CompletionTime:j,UrlName:u,Rules:r,RuleType:parseInt(h.ruleMatchType,10),Tags:t})})}return b};MySpace.Bunchball.Nitro.Initialize=function(){if(!this.initialized){this.initialized=true;this.retryInterval=100;this.retryTries=100;var b=this;if(!this.ConnectionInfo.SessionKey){this.MakeApiCall("user.login",{apiKey:this.ConnectionInfo.ApiKey,ts:this.ConnectionInfo.Timestamp,sig:this.ConnectionInfo.Signature,userId:this.ConnectionInfo.UserId},function(c){b.ConnectionInfo.SessionKey=c.Login.sessionKey})}}}})(jQuery);(function(a){namespace("MySpace.UI.Reputation.BadgeList");MySpace.UI.Reputation.BadgeList=function(d,b,g,e,h){var c=a("#badges",d);var k=this;function j(m){var l={showTooltip:true};k.options=a.extend({},l,m)}function i(l){var m="selected";a(".badge",c).removeClass(m);l.addClass(m);if(g){g(l.data("badge"))}}function f(){j(h);var l=a('<ul class="badgeList"></ul>');a.each(b,function(o,m){var p=m.IsAchieved?m.ThumbUrl:m.LockedUrl;var n=String.format(MySpace.UI.Reputation.Resources.BadgeUrlFormat,m.UrlName);var q=a(String.format('<li class="badge"><img alt="{0}" src="{1}"/><a href="{2}" class="name">{0}</a></li>',m.Name,p,n)).data("badge",m);var s=a("<span />").html(m.Description);s.find(".share").remove();if(k.options.showTooltip){a("img",q).flyout({title:m.Name,content:s.html(),classes:"badgeTooltip",positions:"ur|ul"})}q.click(function(){i(q);return false});if(m.IsLimitedEdition){var r=a('<strong class="limited"></strong>').text(MySpace.UI.Reputation.Resources.Reputation_LimitedEdition);a(q).append(r)}if(e===m){i(q)}l.append(q)});c.append(l)}f()}})(jQuery);(function(a){namespace("MySpace.UI.Reputation.ShareBadge");MySpace.UI.Reputation.ShareBadge=function(b,c){var e=String.format(MySpace.UI.Reputation.Resources.ShareBadgeTitle,b.Name);var f=window.location.host+String.format(MySpace.UI.Reputation.Resources.ShareBadgeUrl,b.UrlName);var d=new MySpace.UI.ShareButton(c||a("body"));voidPopup({url:f,title:e})}})(jQuery);(function(a){namespace("MySpace.UI.Reputation.RecentBadges");MySpace.UI.Reputation.RecentBadges.Initialize=function(){function d(h,f){var j=a(".info",h);a("img",j).attr("src",f.FullUrl).attr("alt",f.Name);var g=String.format(MySpace.UI.Reputation.Resources.BadgeUrlFormat,f.UrlName);a(".name a",j).attr("href",g).text(f.Name);var i=a(".description",j).html(f.Description);a(".share",i).click(function(){new MySpace.UI.Reputation.ShareBadge(f,a(this));return false})}function c(f,g,h){a(".badgesAchieved",f).text(String.format(MySpace.UI.Reputation.Resources.ReputationBadges_NumBadgesAchieved,g,h))}function e(g,f,h){function i(j){d(g,j)}new MySpace.UI.Reputation.BadgeList(g,f,i,h,{showTooltip:false})}function b(j){var f=j.badges;var k=a(".recentBadgesModule");var i=f.length;var l=j.totalBadges;c(k,i,l);if(i>0){var h=4;f=f.splice(0,h);var g=f[0];d(k,g);e(k,f,g)}else{a(".hasbadges",k).hide();a(".nobadges",k).show()}}MySpace.Bunchball.Nitro.GetRecentBadges(MySpace.ClientContext.DisplayFriendId,b)}})(jQuery);