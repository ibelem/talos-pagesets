(function(l,i){if(l.jQuery!==i){jQuery.noConflict();var d=jQuery;d.RJS_Helpers&&d().RJS_Slideshow&&(new function(){var a=this;d.extend(a,{settings:{noready:[0,"Int","^[0-1]$"],maxitem:[3,"Int","^[1-9]$"],minitem:[1,"Int","^[1-9]$"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],pagespeed:[100,"Range","0,9999"],opacityspeed:[100,"Range","0,9999"],omitname:[38,"Range","0,100"],imagesize:["80x80","Str","^[1-9]{1}[0-9]{1,2}x[1-9]{1}[0-9]{1,2}"],autoslidetime:[2,"Range","1,99"],autoslideflag:["next","Str","^(next|prev)$"],
autoslide:[0,"Int","^[0-1]$"],autoresize:[0,"Int","^[0-1]$"],impvar:["","Str","^[a-zA-Z0-9_]{3,64}$"],impdisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],impnodisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],verticalmode:[0,"Int","^[1]$"],jsonashiatourl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/]+)$"],jsonrecourl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/]+)$"],ajaxtimer:[3,"Range","1,99"],recocount:[13,
"Range","1,20"]},eobj:{config:d("#ashiatoRecoConfig"),existItem:d("#ashiatoRecoExistItemDisplay"),overMaxItem:d("#ashiatoRecorMaxItemDisplay"),prototypeAshiatoItem:d("#prototypeAshiatoRecoAshiatoItem"),prototypeRecoItem:d("#prototypeAshiatoRecoRecoItem"),prevButton:d("#ashiatoRecoPrevButton"),nextButton:d("#ashiatoRecoNextButton"),loaddisableding:d("#ashiatoRecoLoading"),altContents:d("#ashiatoRecoAlteredContents"),ashiatoItemDisplay:d("#ashiatoRecoAshiatoItemDisplay"),recoItemsDisplay:d("#ashiatoRecoRecoItemsDisplay")},
status:{error:false,isTimeout:false},props:{ashiatoItems:[],ashiatoItemPrototype:{html:"",height:0,width:0,identifiers:{itemurl:["",/\#ITEMURL\#/g,""],imageurl:['<img src="',/\#ITEMIMGELE\#/g,'" >'],itemname:["",/\#ITEMNAME\#/g,""]}},recoItems:[],recoItemPrototype:{html:"",height:0,width:0,identifiers:{item_url:["",/\#ITEMURL\#/g,""],image_url_80:['<img src="',/\#ITEMIMGELE\#/g,'" >'],item_name:["",/\#ITEMNAME\#/g,""]}},currAshiatoItemIndex:false},initialize:function(){if(a.loaddisabledSettings())a.settings.noReady==
1?a.begin():d(document).ready(function(){a.begin()});else a.displayDefaultContents()},loaddisabledSettings:function(){a.settings=d.RJS_Helpers.readAttr(a.eobj.config,a.settings);if(a.settings.jsonashiatourl==""||a.settings.jsonashiatourl.length>512)return false;if(a.settings.jsonrecourl==""||a.settings.jsonrecourl.length>512)return false;a.settings.autoslidetime*=1E3;a.settings.ajaxtimer*=1E3;a.eobj.config.remove();return true},begin:function(){a.getAshiatoData();a.status.error=!a.getPrototype()},getAshiatoData:function(){function b(g){if(a.status.isTimeout)return false;
clearTimeout(c);if(g.code===i||g.num===i){a.displayDefaultContents();return false}if(g.code!="0"){if(g.code=="1"||g.code=="8")a.regImpressionCode(a.settings.impnodisp);a.displayDefaultContents();return false}if(g.items.length<1){a.displayDefaultContents(a.settings.impnodisp);return false}a.props.ashiatoItems=g.items;a.getRecoData()}var c;a.status.isTimeout=false;try{c=setTimeout(function(){a.status.isTimeout=true;a.displayDefaultContents()},a.settings.ajaxtimer);d.ajax({url:a.settings.jsonashiatourl,
cache:false,dataType:"jsonp",scriptCharset:"euc-jp",timeout:a.settings.ajaxtimer,success:function(g){b(g)},error:function(){a.displayDefaultContents();a.status.isTimeout=true}})}catch(e){a.displayDefaultContents();return false}return true},setNewAshiatoItemId:function(){var b=a.props.ashiatoItems.length,c=a.props;for(c.currAshiatoItemIndex===false?c.currAshiatoItemIndex=0:c.currAshiatoItemIndex++;c.currAshiatoItemIndex<b;){if(/^http:\/\/item.rakuten.co.jp/.test(c.ashiatoItems[c.currAshiatoItemIndex].itemurlfull))return true;
c.currAshiatoItemIndex++}return c.currAshiatoItemIndex=false},getRecoData:function(){function b(f){var m,j,k,h;if(a.status.isTimeout)return false;clearTimeout(c);if(f.status==i||f.item_count==i){a.displayDefaultContents();return false}if(f.status!="Success"&&f.status!="NotFound")a.displayDefaultContents();else{k=f.item.length;if(k<a.settings.minitem){a.getRecoData();return false}m=a.settings.imagesize;for(h=k-1;h>=0;h--){j=f.item[h];j.item_name=d.RJS_Helpers.omitStr(j.item_name,a.settings.omitname,
"\u2026");j.image_url_80=d.RJS_Helpers.urlParameter(j.image_url_80,{_ex:m});if(a.settings.sid!="")j.item_url=d.RJS_Helpers.urlParameter(j.item_url,{"s-id":a.settings.sid})}if(!d.browser.msie)for(h=k-1;h>=0;h--)f.item[h].item_name=f.item[h].item_name.split("").join(String.fromCharCode(8203));a.props.recoItems=f.item;if(a.status.error){a.displayDefaultContents();return false}else{a.startSlideshow();a.regImpressionCode(a.settings.impdisp);return true}}}var c,e;a.status.isTimeout=false;a.setNewAshiatoItemId();
if(a.settings.recocount<=0||a.props.currAshiatoItemIndex===false)a.displayDefaultContents(a.settings.impnodisp);else{try{e=a.props.ashiatoItems[a.props.currAshiatoItemIndex];a.settings.recocount--;c=setTimeout(function(){a.displayDefaultContents();a.status.isTimeout=true},a.settings.ajaxtimer);d.ajax({url:a.settings.jsonrecourl,cache:false,dataType:"jsonp",data:{item_id:e.shopid+"_"+e.itemid},scriptCharset:"euc-jp",timeout:a.settings.ajaxtimer,success:function(f){b(f)},error:function(){a.displayDefaultContents();
a.status.isTimeout=true}})}catch(g){a.displayDefaultContents();return false}return true}},getPrototype:function(){var b=a.eobj.prototypeRecoItem,c=a.props.recoItemPrototype;if(b.length==0)return false;c.width=b.outerWidth();c.height=b.outerHeight();c.html=b.html();if(c.html=="")return false;b.remove();if(a.eobj.prototypeAshiatoItem.length==0)return false;a.props.ashiatoItemPrototype.html=a.eobj.prototypeAshiatoItem.html();a.eobj.prototypeAshiatoItem.remove();return true},startSlideshow:function(){a.eobj.itemsDisplay=
a.eobj.recoItemsDisplay;a.eobj.existItem.show();a.eobj.itemsDisplay.RJS_Slideshow(a,{settings:a.settings,itemPrototype:a.props.recoItemPrototype,eobj:a.eobj,items:a.props.recoItems,itemEvents:a.props.itemEvents,events:{afterFirstRender:a.afterFirstRender,beforeFirstRender:a.beforeFirstRender}})},regImpressionCode:function(b){return l[a.settings.impvar]===i||b==""?"":l[a.settings.impvar]=b},displayDefaultContents:function(b){a.eobj.loaddisableding.remove();a.eobj.altContents.show();a.eobj.existItem.remove();
b&&a.regImpressionCode(b)},afterFirstRender:function(b,c){c.props.recoItems.length>b&&c.eobj.overMaxItem.show()},prepareAshiatoItem:function(){var b,c,e;b=a.props.ashiatoItems[a.props.currAshiatoItemIndex];b.itemname=d.RJS_Helpers.omitStr(b.itemname,a.settings.omitname,"\u2026");if(!d.browser.msie)b.itemname=b.itemname.split("").join(String.fromCharCode(8203));b.imageurl=b.imageurl!=""?d.RJS_Helpers.urlParameter(b.imageurl,{_ex:a.settings.imagesize}):b.imageurl64;if(a.settings.sid!="")b.itemurl=d.RJS_Helpers.urlR2Parameter(b.itemurl,
{"s-id":a.settings.sid},false);c=a.props.ashiatoItemPrototype.html;for(e in a.props.ashiatoItemPrototype.identifiers)c=c.replace(a.props.ashiatoItemPrototype.identifiers[e][1],b[e]!=i?a.props.ashiatoItemPrototype.identifiers[e][0]+b[e]+a.props.ashiatoItemPrototype.identifiers[e][2]:"");b.ele=d(c);a.eobj.ashiatoItemDisplay.append(b.ele);a.eobj.ashiatoItemDisplay.show()},beforeFirstRender:function(b,c){c.eobj.loaddisableding.remove();c.prepareAshiatoItem();c.eobj.recoItemsDisplay.show()}})}).initialize()}})(this);
