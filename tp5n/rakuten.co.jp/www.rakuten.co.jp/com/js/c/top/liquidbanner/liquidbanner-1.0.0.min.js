/*
 liquidbanner 1.0.0
 Copyright (c) 2011 Rakuten.Inc
 Date : 2011-03-29 12:23:24
*/
(function(t,l){if(t.jQuery!==l){jQuery.noConflict();var g=jQuery;if(g.RJS_Helpers){var v=function(f,h){var a=this;if(!(f===l||h===l)){a.mainObj=f;g.extend(this,{settings:{maxitem:5,pagespeed:100,opacityspeed:100,autoslidetime:2,autoslideflag:"",autoslide:0,autoresize:0,verticalmode:0},eobj:{itemsDisplay:false,prevButton:false,nextButton:false,backButton:false},canvas:{front:false,back:false,autoPlayTimer:false},itemPrototype:{html:"",height:0,width:0},items:false,itemIndex:[],itemEvents:{remove:false},
status:{animation:false,preparingItems:false,renderReset:false,resizeCurrStart:false,resizeCurrEnd:false,callBackResize:false},pageConf:{maxAllowed:5,currStart:0,currEnd:0,currCnt:0,width:0,nowPage:0,maxPage:0},events:{onItemRemove:false,afterFirstRender:false,beforeFirstRender:false,onZeroItems:false,onResize:false,changePageNumber:false}},h);g.extend(this,{initialize:function(){var b=0,c,e;if(a.items.length<1||!a.eobj.itemsDisplay||!a.eobj.prevButton||!a.eobj.nextButton)return a;for(c in a.items){a.itemIndex[b]=
c;b++}b=a.itemIndex.length;for(e in a.events)!g.isFunction(a.events[e])&&(a.events[e]=false);if(a.settings.autoslide===1&&!g.isFunction(a[a.settings.autoslideflag]))a.settings.autoslide=0;else{a.eobj.itemsDisplay.hover(function(){a.stop()},function(){a.play()});a.eobj.prevButton.hover(function(){a.stop()},function(){a.play()});a.eobj.nextButton.hover(function(){a.stop()},function(){a.play()});a.eobj.backButton.hover(function(){a.stop()},function(){a.play()})}a.pageConf.maxAllowed=Math.min(a.settings.maxitem,
b);if(a.settings.autoresize===1&&a.settings.verticalmode===0&&a.itemPrototype.width>0){a.resize(false);g(t).resize(function(){a.resize(true)})}e=Math.min(a.pageConf.maxAllowed,b);a.prepareItems(0,e).render(0,e,false).manageControls().prepareItems(e,b);return a},prepareItems:function(b,c){var e=a.itemPrototype.html,d=a.itemPrototype.identifiers,j="",n,i,k;if(a.status.preparingItems)return a;if(a.status.animation){setTimeout(function(){a.prepareItems(b,c)},a.settings.pagespeed);return a}a.status.preparingItems=
true;for(i=b;i<c;i++){j=e;n=a.items[a.itemIndex[i]];for(k in d)j=j.replace(d[k][1],n[k]!=l?d[k][0]+n[k]+d[k][2]:"");n.ele=g(j)}if(a.itemEvents.remove!="")for(i=b;i<c;i++)a.items[a.itemIndex[i]].ele.find(a.itemEvents.remove).attr("id","").bind("click",{index:i},function(m){m.preventDefault();a.removeItem(m.data.index);return false});a.status.preparingItems=false;return a},render:function(b,c,e,d){function j(){function n(o,p,s){if(o=a.items[a.itemIndex[o]])o.ele.animate({opacity:0},a.settings.opacityspeed,
"linear");if(p=a.items[a.itemIndex[p]])p.ele.animate({opacity:1},a.settings.opacityspeed,"linear");s||setTimeout(function(){a.canvas.front[0]!==l&&a.canvas.front[0].parentNode!==null&&a.canvas.front[0].parentNode.removeChild(a.canvas.front[0]);a.canvas.front=a.canvas.back;a.play();a.status.animation=false;a.status.renderReset=false;a.status.callBackResize&&a.resize(true)},a.settings.opacityspeed)}var i=a.pageConf.maxAllowed,k=1,m=c-b,q,r,u=true;if(d){q=a.pageConf.currCnt!=i?Math.ceil(a.pageConf.currEnd/
i)*i-1:a.pageConf.currEnd-1;r=m!=i?Math.ceil(c/i)*i-1:c-1;if(a.status.renderReset){q=-1;if(m!=i){i=m;r=c-1}}k=-1}else{q=a.pageConf.currStart;r=b}for(m=0;u;m++,q+=k,r+=k)setTimeout(function(o,p,s){return function(){n(o,p,s)}}(q,r,u=m+1<i),m*a.settings.pagespeed)}if(a.status.animation||a.status.preparingItems)return a;e=typeof e!==l?e===false?false:true:true;d=typeof d!==l?d===true?true:false:false;if(b<0)return a;a.status.animation=true;a.stop();if(c>a.itemIndex.length){c=a.itemIndex.length;if(c-b>
a.pageConf.maxAllowed)return a}if(e===false){a.canvas.front=a.prepareElements(b,c,2,1);a.events.beforeFirstRender&&a.events.beforeFirstRender(a.pageConf.maxAllowed,a.mainObj);a.eobj.itemsDisplay.append(a.canvas.front);a.play();a.status.animation=false;a.events.afterFirstRender&&a.events.afterFirstRender(a.pageConf.maxAllowed,a.mainObj)}else{a.status.renderReset&&a.canvas.front[0].parentNode.removeChild(a.canvas.front[0]);a.canvas.back=a.prepareElements(b,c,2,0);a.eobj.itemsDisplay.append(a.canvas.back);
j()}a.pageConf.currStart=b;a.pageConf.currEnd=c;a.pageConf.currCnt=c-b;a.manageControls();a.updatePageNumber();a.events.changePageNumber&&a.events.changePageNumber(a.pageConf.nowPage,a.pageConf.maxPage,a.mainObj);return a},prepareElements:function(b,c,e,d){e={"z-index":e,opacity:d,position:"relative"};var j;d=g("<div>").css({position:"absolute",width:"100%","float":"none"});for(j=b;j<c;j++){b=a.items[a.itemIndex[j]].ele;d.append(b.css(e))}a.justifyElements(d);return d},manageControls:function(){if(a.pageConf.currStart===
0&&a.pageConf.currEnd>=a.itemIndex.length){a.eobj.prevButton.find("a").hide();a.eobj.nextButton.find("a").hide();a.eobj.backButton&&a.eobj.backButton.find("a").hide()}else{a.eobj.prevButton.find("a").show().focus(function(){this.blur()}).unbind("click").click(function(b){b.preventDefault();a.prev();return false});a.eobj.nextButton.find("a").show().focus(function(){this.blur()}).unbind("click").click(function(b){b.preventDefault();a.next();return false});a.eobj.backButton&&a.eobj.backButton.find("a").show().focus(function(){this.blur()}).unbind("click").click(function(b){b.preventDefault();
a.pageConf.currStart!=0&&a.render(0,a.pageConf.maxAllowed);return false})}return a},prev:function(){if(a.pageConf.currStart===0&&a.pageConf.currEnd===a.itemIndex.length)return a;a.pageConf.currStart===0?a.render(Math.floor((a.itemIndex.length-1)/a.pageConf.maxAllowed)*a.pageConf.maxAllowed,a.itemIndex.length):a.render(a.pageConf.currStart-a.pageConf.maxAllowed,a.pageConf.currStart);return a},next:function(){if(a.pageConf.currStart===0&&a.pageConf.currEnd===a.itemIndex.length)return a;a.pageConf.currEnd>=
a.itemIndex.length?a.render(0,a.pageConf.maxAllowed,true,true):a.render(a.pageConf.currEnd,a.pageConf.currEnd+a.pageConf.maxAllowed,true,true);return a},removeItem:function(b){var c=a.canvas.front,e,d,j;e=false;var n;if(a.status.animation||a.status.preparingItems)return false;a.items[b].ele.fadeOut(a.settings.opacityspeed,function(){g(this).remove()});a.events.onItemRemove&&a.events.onItemRemove(b,a.mainObj);if(a.itemIndex.length==1){a.events.onZeroItems&&a.events.onZeroItems(a.mainObj);return false}b=
g.inArray(b+"",a.itemIndex);if(b==-1)return false;a.itemIndex.splice(b,1);if(a.pageConf.currEnd==a.itemIndex.length+1){a.pageConf.currEnd--;a.pageConf.currCnt--}if(b==a.itemIndex.length)b%a.pageConf.maxAllowed==0&&a.prev();else{a.status.animation=true;d=b;for(j=0;!e;d++,j++){e=a.items[a.itemIndex[d]].ele;e.css({"z-index":1,opacity:0});if(n=d==a.pageConf.currEnd-1){c.append(e);if(d==b)j=1}setTimeout(function(i,k){return function(){i.animate({opacity:"1"},a.settings.opacityspeed,"linear",function(){a.status.animation=
k;!a.status.animation&&a.status.callBackResize&&a.resize(true)})}}(e,!(e=d===a.itemIndex.length-1||n)),j*a.settings.pagespeed)}}a.justifyElements().manageControls();return false},play:function(){if(a.settings.autoslide===0||a.autoPlayTimer)return a;a.autoPlayTimer=setTimeout(function(){a[a.settings.autoslideflag]()},a.settings.autoslidetime);return a},stop:function(){if(a.settings.autoslide===0)return a;clearTimeout(a.autoPlayTimer);a.autoPlayTimer=false;return a},justifyElements:function(b){var c=
a.pageConf.maxAllowed;if(a.settings.autoresize!==1)return a;if(b===l)b=a.canvas.front;b.children("*").css("width",c>=a.settings.maxitem?Math.floor(99/c*1E4)/1E4+"%":"");return a},resize:function(b){var c=a.pageConf,e,d;if(a.status.animation||a.status.preparingItems){a.status.callBackResize=true;return a}e=a.eobj.itemsDisplay.width();d=Math.floor(e/a.itemPrototype.width);if(d<a.settings.maxitem)d=a.settings.maxitem;if(d==c.maxAllowed)return a;e=c.maxAllowed;c.maxAllowed=d;if(!b)return a;a.status.animation=
true;a.stop();if(a.status.renderReset){b=a.status.resizeCurrStart;d=a.status.resizeCurrEnd}else{b=c.currStart;d=c.currEnd}cntItem=d-b;if(c.maxAllowed>e){if(d!=a.itemIndex.length){frontEle=a.canvas.front;for(e=cntItem;e<c.maxAllowed;e++){d=b+e;if(d>=a.itemIndex.length)break;if(a.itemIndex[d]===l)break;d=a.items[a.itemIndex[d]].ele;d.css("z-index",2).animate({opacity:1},0);frontEle.append(d)}d=b+e}}else if(cntItem>c.maxAllowed){for(e=cntItem;e>c.maxAllowed;e--){d=b+e-1;if(a.itemIndex[d]===l)break;d=
a.items[a.itemIndex[d]].ele;d[0].parentNode&&d[0].parentNode.removeChild(d[0])}d=b+e}a.status.resizeCurrStart=b;a.status.resizeCurrEnd=d;c.currCnt=d-b;a.status.renderReset=true;a.justifyElements();e=b%c.maxAllowed;if(e!=0)b+=c.maxAllowed-e;d=b+c.maxAllowed;if(d>a.itemIndex.length)d=a.itemIndex.length;c.currStart=b;c.currEnd=d;a.manageControls();a.events.onResize&&a.events.onResize(c,a.mainObj);a.status.animation=a.status.callBackResize=false;a.play();a.updatePageNumber();a.events.changePageNumber&&
a.events.changePageNumber(c.nowPage,c.maxPage,a.mainObj);return a},updatePageNumber:function(){var b=Math.ceil(a.items.length/a.pageConf.maxAllowed),c;for(c=1;c<b;c++)if(a.pageConf.currEnd<=c*a.pageConf.maxAllowed)break;a.pageConf.nowPage=c;a.pageConf.maxPage=b;return a}});a.initialize()}};g.fn.RJS_Slideshow_110_beta1=function(f,h){this.each(function(){new v(f,h)})};(new function(){var f=this;g.extend(f,{settings:{autoslidetime:[7E3,"Range","0,9999"],autoslideflag:["next","Str","^(next|prev)$"],autoslide:[1,
"Int","^[0-1]$"],maxitem:[2,"Int","^[1-9]$"],pagespeed:[50,"Range","0,9999"],opacityspeed:[200,"Range","0,9999"],verticalmode:[0,"Int","^[1]$"],autoresize:[1,"Int","^[0-1]$"],defaultcontentid:["flashcontent","Str","^[a-zA-Z0-9_-]{3,32}$"]},eobj:{config:g("#liquidBanner-config"),frame:g("#liquidBanner-frame"),prototypeItem:g("#liquidBanner-item"),itemsDisplay:g("#liquidBanner-body"),prevButton:g("#liquidBanner-prev"),nextButton:g("#liquidBanner-next"),backButton:g("#liquidBanner-back"),nowPage:g("#liquidBanner-nowPage"),
maxPage:g("#liquidBanner-maxPage")},status:{error:false,isTimeout:false},props:{items:[],itemPrototype:{html:"",height:0,width:0,identifiers:{banner1:["",/\#BANNER1\#/g,""],banner2:["",/\#BANNER2\#/g,""]}}},initialize:function(){f.loaddisabledSettings();f.begin()},loaddisabledSettings:function(){f.settings=g.RJS_Helpers.readAttr(f.eobj.config,f.settings);f.eobj.config.remove();return true},begin:function(){f.status.error=!f.getPrototype();f.getData()},getData:function(){var h,a,b=g("li","#liquidBanner-list");if(b.length<
1)return false;var c=Math.ceil(b.length/2),e=b[0]?g(b[0]).html():"";for(a=h=0;h<c;h++){f.props.items[h]=[];f.props.items[h].banner1=b[a]?g(b[a++]).html():e;f.props.items[h].banner2=b[a]?g(b[a++]).html():e}f.startSlideshow();return true},getPrototype:function(){var h=f.eobj.prototypeItem,a=f.props.itemPrototype;if(h.length==0)return false;a.width=h.outerWidth();a.height=h.outerHeight();a.html=h.html();if(a.html=="")return false;h.remove();return true},startSlideshow:function(){g("#"+f.settings.defaultcontentid).hide();
f.eobj.frame.show();f.eobj.itemsDisplay.RJS_Slideshow_110_beta1(f,{settings:f.settings,itemPrototype:f.props.itemPrototype,eobj:f.eobj,items:f.props.items,events:{beforeFirstRender:f.beforeFirstRender,changePageNumber:f.changePageNumber}})},beforeFirstRender:function(h,a){a.eobj.itemsDisplay.show();var b=setInterval(function(){if(a.props.items[a.props.items.length-1].ele){for(var c in a.props.items)a.props.items[c].ele.find("li div").each(function(){g(this).hover(function(){g(this).css("top","-2px")},
function(){g(this).css("top","0px")})});clearInterval(b)}},100)},changePageNumber:function(h,a,b){b.eobj.nowPage.text(h);b.eobj.maxPage.text(a);h==1?b.eobj.backButton.hide():b.eobj.backButton.show()}})}).initialize()}}})(this);
