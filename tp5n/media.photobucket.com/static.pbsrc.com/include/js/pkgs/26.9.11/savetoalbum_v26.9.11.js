var usePB_Jquery=(typeof jQuery=="function");var PBxDomMsg={initialize:function(C,A){var B=/^(?:(?:(top|parent|frames\[(?:(?:['"][a-zA-Z\d-_]*['"])|\d+)\]))(?:\.|$))+/;if(B.test(C)){this.address=C}else{throw new Error("Invalid Message Target")}if(usePB_Jquery){this.memo=A}else{this.memo=(Object.isString(A))?A:A.toQueryString()}this.type="XdComMessage";return this},toQueryString:function(){var A={address:this.address,memo:this.memo};if(usePB_Jquery){return"address="+A.address+"&memo="+A.memo}else{return Object.toQueryString(A)}},type:"XdComMessage"};var PBxDom={initialize:function(){this.iframe=null;this.proxyUrl=null;this.isReady=false}void:function(A){this.proxyUrl=A;if(!this.iframe){if(usePB_Jquery){jQuery("<iframe />").attr({id:"pb_xdom",src:this.proxyUrl}).css({visibility:"hidden",position:"absolute",top:"0",left:"0",height:"1px",width:"1px"}).appendTo("body");jQuery("#pb_xdom").bind("loaddisabled",{customevnt:this.event.onLoad},function(B){jQuery(document).trigger(B.data.customevnt)});this.iframe=jQuery("#pb_xdom")}else{this.iframe=new Element("iframe",{src:this.proxyUrl});this.iframe.setStyle({visibility:"hidden",position:"absolute",top:0,left:0,height:"1px",width:"1px"});document.body.appendChild(this.iframe);Event.observe(this.iframe,"loaddisabled",function(){this.isReady=true;document.fire(this.event.onLoad)}.bind(this))}}},close:function(){if(this.iframe){if(usePB_Jquery){jQuery("#pb_xdom").remove()}else{this.iframe.remove()}}},send:function(A){if(!this.iframe||!this.proxyUrl){throw new Error("Proxy Closed")}else{if(A.type==PBxDomMsg.type){var B=A.toQueryString();if(usePB_Jquery){this.iframe.attr({src:this.proxyUrl+"#"+B})}else{this.iframe.src=this.proxyUrl+"#"+B}}else{throw new Error("Invalid Message")}}},event:{onLoad:"PBxDom:ProxyReady"}};var SaveToAlbumController;(function(){var A={initialize:function(){Event.observe(document,SaveToAlbumController.EVENT.ACTIVATE,this.activate.bindAsEventListener(this))},activate:function(C){var D=C.memo;if(D.isLoggedIn){PB.Controller.XdCom.getInstance()void();Event.observe(document,PB.Util.XdComReceiver.event.onMessage,this.onMessage.bindAsEventListener(this))}PBLightbox.getInstance();document.fire(PBLightbox.EVENT.ACTIVATE,{contentUrl:"/savetoalbumview",onComplete:function(){if(D.isLoggedIn){var E="200px";var G=document.domain;var F=unescape(D.viewerSaveToAlbumUrl)+"&mediaUrls[]="+D.mediaUrl+"&PBPROXY="+G;var H=$("staiFrame");H.style.height=E;H.src=F;H.show()}else{$("statuspanel").show();document.fire(PBLightbox.PBMessage.EVENT.NOTIFY,{message:new PBMessage({title:"",details:'WARNING: You must be logged in before you can save a copy of this media to your album. <a class="yellowLink" href="/login?returnUrl='+D.mediaBrowseUrl+'">Login</a> or <a class="yellowLink" href="/register">Register</a> to get started.',type:PBMessage.MESSAGE_TYPE.ALERT})});$("btnloggedout").show()}}})},onMessage:function(C){var D=C.memo;switch(D){case"loaddisableded":this.closeProgress();break;case"close":this.closeFrame();break;case"success":$("staiFrame").style.height="450px";break;case"successAsk":$("staiFrame").style.height="600px";break;case"error":$("staiFrame").style.height="300px";break;default:break}},showSuccess:function(C){$("staiFrame").hide();Event.observe($("view_in_album"),"click",function(D){document.location.href=C});$("btnsuccess").show();$("statuspanel").show();this.msgAlert("status","All files were copied to your album.")},closeFrame:function(){document.fire(PBLightbox.EVENT.DEACTIVATE)},closeProgress:function(){document.fire(PBLightbox.PBProgress.EVENT.DEACTIVATE)},msgAlert:function(D,E){var C=(D=="error")?"Attention":"Success";document.fire(PBLightbox.PBMessage.EVENT.NOTIFY,{message:new PBMessage({title:C,details:E,type:D})});return }};var B={EVENT:{ACTIVATE:"SaveToAlbumController:activate"}};Controller.create("SaveToAlbumController",A,B)})();(function(){var A={initialize:function(E,C){var D=/^(?:(?:(top|parent|frames\[(?:(?:['"][a-zA-Z\d-_]*['"])|\d+)\]))(?:\.|$))+/;if(D.test(E)){this.address=E}else{throw new Error("Invalid Message Target")}if(Object.isString(C)){this.memo=C}else{this.memo=C.toQueryString()}this.type=PB.Util.XdComMessage.type},toQueryString:function(){var C={address:this.address,memo:this.memo};return Object.toQueryString(C)}};var B={type:"XdComMessage"};Object.extend(PB.Util,{XdComMessage:Object.extend(Class.create(A),B)})})();(function(){var publicMembers={initialize:function(){},send:function(message){if(message.address&&message.memo){try{if(message.type!=PB.Util.XdComMessage.type){message=new PB.Util.XdComMessage(message.address,message.memo)}var target=eval(message.address);target.document.title=message.memo}catch(e){throw new Error("XdComMessage.address not found")}}else{throw new Error("Invalid Message")}}};var staticMembers={};Object.extend(PB.Util,{XdComSender:Object.extend(Class.create(publicMembers),staticMembers)})})();(function(){var A={initialize:function(){this.delay=100;this.timerId=-1;this.oTitle=document.title;this.dispatcher=this.dispatch.bind(this)},start:function(){if(this.timerId==-1){this.timerId=window.setInterval(this.dispatcher,this.delay)}},stop:function(){if(this.timerId!=-1){window.clearInterval(this.timerId);this.timerId=-1}},getMessage:function(){var C=null;if(document.title!=this.oTitle){C=document.title;document.title=this.oTitle}return C},dispatch:function(){var C=this.getMessage();if(C){document.fire(PB.Util.XdComReceiver.event.onMessage,C)}}};var B={event:{onMessage:"PB:XdComReceiverOnMessage"}};Object.extend(PB.Util,{XdComReceiver:Object.extend(Class.create(A),B)})})();(function(){var A={initialize:function(){this.sender=new PB.Util.XdComSender();this.receiver=new PB.Util.XdComReceiver()}void:function(){this.receiver.start()},close:function(){this.receiver.stop()},send:function(C){this.sender.send(C)}};var B={};Controller.create("XdCom",A,B)})();