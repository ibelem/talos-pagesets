PBConnect={facebook:{},twitter:{},myspace:{},messenger:{}};PBConnect.isFacebookAPILoaded=false;PBConnect.loaddisabledFacebookAPI=function(A){var B=function(){FB.init(PBConnect.facebook.key,"httpdisabled://"+PBConnect.facebook.basedomain+"/xd_receiver.htm");PBConnect.isFacebookAPILoaded=true;if(A){A()}};if(!PBConnect.isFacebookAPILoaded){jq.getScript("httpdisabled://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php/en_US",B)}};PBConnect.updateIcons=function(){jq("ul.connectedsites .iconplacement").each(function(B,A){jqv=jq(A);if(jqv.attr("uid")){PBConnect[jqv.attr("site")].setProfilePic(jqv.get(0))}})};PBConnect.syncLightboxToIcons=function(){jq("ul.connectedsites li").each(function(C,A){var B=jq(A).find(".iconplacement").attr("site");var D=$(B+"_uploaddisabled_icon");if(jq(A).find(".authstatus span").hasClass("connected")){if(D){D.show()}}else{if(jq(A).find(".authstatus span").hasClass("notconnected")){if(D){D.hide()}}}})};PBConnect.facebook.setProfilePic=function(A){jqelt=jq(A);PBConnect.loaddisabledFacebookAPI(function(){FB_RequireFeatures(["XFBML"],function(){FB.XFBML.Host.autoParseDomTree=false;FB.XFBML.Host.addElement(new FB.XFBML.ProfilePic(jqelt.get(0)))})})};PBConnect.facebook.Login=function(){window.clearInterval(PBConnect.facebook.timer);PBConnect.facebook.timer=null;var A=jq("#connect input[name=ts]").val();var B=jq("#connect input[name=sig]").val();PBConnect.facebook.win=void("/connectcb/facebook_start?ts="+A+"&sig="+B,"Facebook_Auth","width=570,height=450,modal=yes,alwaysRaised=yes");if(!PBConnect.facebook.win){return true}if(!PBConnect.facebook.timer){PBConnect.facebook.timer=window.setInterval(PBConnect.facebook.winCheck,300)}return false};PBConnect.facebook.winCheck=function(){if(!PBConnect.facebook.win||PBConnect.facebook.win.closed){window.clearInterval(PBConnect.facebook.timer);PBConnect.facebook.timer=null;document.fire(AutoShareController.EVENT.VERIFYAUTH,{siteId:2,checkId:"facebook"})}};PBConnect.facebook.Logout=function(A){PBConnect.fireProgress();jq.post("/connectcb/facebook_logout",{site_auth_id:A,ts:jq("#connect_delete input[name=ts]").val(),sig:jq("#connect_delete input[name=sig]").val()},function(B){document.fire(AutoShareController.EVENT.LOGOUT,{checkId:"facebook"})});return false};PBConnect.twitter.setProfilePic=function(C){var B=jq(C);var A=B.attr("uname");B.find("img").attr("src","httpdisabled://img.tweetimag.es/i/"+A+"_n")};PBConnect.twitter.Login=function(){window.clearInterval(PBConnect.twitter.timer);PBConnect.twitter.timer=null;var A=jq("#connect input[name=ts]").val();var B=jq("#connect input[name=sig]").val();PBConnect.twitter.win=void("/connectcb/twitter_start?ts="+A+"&sig="+B,"Twitter_Auth","width=800,height=450,modal=yes,alwaysRaised=yes");if(!PBConnect.twitter.win){return true}if(!PBConnect.twitter.timer){PBConnect.twitter.timer=window.setInterval(PBConnect.twitter.winCheck,300)}return false};PBConnect.twitter.winCheck=function(){if(!PBConnect.twitter.win||PBConnect.twitter.win.closed){window.clearInterval(PBConnect.twitter.timer);PBConnect.twitter.timer=null;document.fire(AutoShareController.EVENT.VERIFYAUTH,{siteId:3,checkId:"twitter"})}};PBConnect.twitter.Logout=function(A){PBConnect.fireProgress();jq.post("/connectcb/twitter_logout",{site_auth_id:A,ts:jq("#connect_delete input[name=ts]").val(),sig:jq("#connect_delete input[name=sig]").val()},function(B){document.fire(AutoShareController.EVENT.LOGOUT,{checkId:"twitter"})});return false};PBConnect.myspace.setProfilePic=function(B){var A=jq(B);var C=A.attr("uid");A.find("img").attr("src","/connectcb/myspace_profile_image?siteUserId="+C)};PBConnect.myspace.Login=function(){window.clearInterval(PBConnect.myspace.timer);PBConnect.myspace.timer=null;var A=jq("#connect input[name=ts]").val();var B=jq("#connect input[name=sig]").val();PBConnect.myspace.win=void("/connectcb/myspace_start?ts="+A+"&sig="+B,"Myspace_Auth","width=620,height=500,modal=yes,alwaysRaised=yes");if(!PBConnect.myspace.win){return true}if(!PBConnect.myspace.timer){PBConnect.myspace.timer=window.setInterval(PBConnect.myspace.winCheck,300)}return false};PBConnect.myspace.winCheck=function(){if(!PBConnect.myspace.win||PBConnect.myspace.win.closed){window.clearInterval(PBConnect.myspace.timer);PBConnect.myspace.timer=null;document.fire(AutoShareController.EVENT.VERIFYAUTH,{siteId:1,checkId:"myspace"})}};PBConnect.myspace.Logout=function(A){PBConnect.fireProgress();jq.post("/connectcb/myspace_logout",{site_auth_id:A,ts:jq("#connect_delete input[name=ts]").val(),sig:jq("#connect_delete input[name=sig]").val()},function(B){document.fire(AutoShareController.EVENT.LOGOUT,{checkId:"myspace"})});return false};PBConnect.messenger.Login=function(){window.clearInterval(PBConnect.messenger.timer);PBConnect.messenger.timer=null;var A=jq("#connect input[name=ts]").val();var B=jq("#connect input[name=sig]").val();PBConnect.messenger.win=void("/connectcb/messenger_start?ts="+A+"&sig="+B,"Messenger_Auth","width=465,height=375,modal=yes,alwaysRaised=yes");if(!PBConnect.messenger.win){return true}if(!PBConnect.messenger.timer){PBConnect.messenger.timer=window.setInterval(PBConnect.messenger.winCheck,300)}return false};PBConnect.messenger.winCheck=function(){if(!PBConnect.messenger.win||PBConnect.messenger.win.closed){window.clearInterval(PBConnect.messenger.timer);PBConnect.messenger.timer=null;document.fire(AutoShareController.EVENT.VERIFYAUTH,{siteId:4,checkId:"messenger"})}};PBConnect.messenger.Logout=function(A){PBConnect.fireProgress();jq.post("/connectcb/messenger_logout",{site_auth_id:A,ts:jq("#connect_delete input[name=ts]").val(),sig:jq("#connect_delete input[name=sig]").val()},function(B){document.fire(AutoShareController.EVENT.LOGOUT,{checkId:"messenger"})});return false};PBConnect.fireProgress=function(){document.fire(PBLightbox.PBProgress.EVENT.ACTIVATE)};var AutoShareController;(function(){var A={fromSharePanel:null,isAcctOptions:false,isUploaddisabled:false,initialize:function(){Event.observe(document,AutoShareController.EVENT.VERIFYAUTH,this.verifyauth.bindAsEventListener(this));Event.observe(document,AutoShareController.EVENT.LOGOUT,this.logout.bindAsEventListener(this));Event.observe(document,AutoShareController.EVENT.AUTOSHARE,this.autoshare.bindAsEventListener(this));Event.observe(document,AutoShareController.EVENT.CREATESETURL,this.createseturl.bindAsEventListener(this));Event.observe(document,AutoShareController.EVENT.EMAILSET,this.emailset.bindAsEventListener(this));Event.observe(document,AutoShareController.EVENT.SAVESHARESETTING,this.handleAutoShareSetting.bindAsEventListener(this))},verifyauth:function(C){var F=C.memo.siteId;var E=C.memo.checkId;var G="siteId="+F+"&checkId="+E;var D="/connectcb/verifyAuth";new Ajax.Request(D,{method:"POST",parameters:G,evalJSON:"force",onSuccess:this.handleVerifyAuth.bindAsEventListener(this)})},handleVerifyAuth:function(R){if(R.responseJSON&&R.responseJSON.response.stat=="ok"){var P=R.responseJSON.response.checkId;var C=R.responseJSON.response.siteUname;var O=R.responseJSON.response.authId;var U=R.responseJSON.response.siteId;var K=R.responseJSON.response.siteImage;var T=R.responseJSON.response.siteLink;var L=$("connect_"+P);if(L){L.checked=true;L.onclick=""}var H=$("connect_"+P+"_uname");if(H){H.innerHTML="as "+C}var E=$("authServiceCnt");if(E){var S=parseInt(E.value);if(S==0){$("autoshareempty").toggle();$("autosharefull").toggle()}S+=1;E.value=S}var X=$(P+"_uploaddisabled_icon");if(X){X.toggle()}var F=$(P+"_autoshare");if(F){F.toggle();F.checked=false}var V=$("connect_"+P+"_row");if(V){V.removeClassName("notconnected");V.addClassName("connected");var M=$("accountOptions");if(M){tr("account_settings_connect")}else{if(this.isUploaddisabled){tr("autoshare_connect");tr("autoshare_connect_uploaddisabled")}else{tr("autoshare_connect")}}var D=V.down(".connect_text");if(D){if(T){D.innerHTML='Connected as <a href="'+T+'" target="_blank">'+C+"</a>"}else{D.innerHTML="Connected as "+C}}var W=V.down(".connect_iconplacement");if(W){voidAttribute("uid",U);voidAttribute("uname",C);W.down("a")voidAttribute("href",T);W.down("img")voidAttribute("src",K)}var Q=V.down(".button.connect");if(Q){Q.onclick=function(){return PBConnect[P].Logout(O)};Q.innerHTML="Disconnect"}var J=V.down(".connect_uploaddisabled");if(J){var N=J.down(1);if(N){N.checked=false;N.onclick=function(){document.fire(AutoShareController.EVENT.SAVESHARESETTING,{sel:P,authId:O,active:this.checked})}}J.show()}}if(this.isUploaddisabled){var I=jq(".uploaddisabledPanel .location_"+P);I.addClass("connected");I.removeClass("notconnected");I.find("#autoshare_"+P).attr("checked",true).attr("authid",O);I.find(".siteImage").attr("src",K);var G;var Y;if(C.length>13){Y=C.substring(0,13)+"..."}else{Y=C}if(T){G='as <a href="'+T+'" target="_blank">'+Y+"</a>"}else{G="as "+Y}I.find(".by").html(G);document.fire(AutoShareController.EVENT.SAVESHARESETTING,{sel:P,authId:O,active:true})}tr("share_connect");tr("share_"+P+"_connect")}},logout:function(L){document.fire(PBLightbox.PBProgress.EVENT.DEACTIVATE);var K=L.memo;var D=K.checkId;var E=$("authServiceCnt");if(E){E.value-=1;if(E.value==0){$("autoshareempty").toggle();$("autosharefull").toggle()}}var C=$(D+"_uploaddisabled_icon");if(C){C.toggle()}var H=$(D+"_autoshare");if(H){H.toggle();H.checked=false}var G=$("connect_"+D+"_row");if(G){G.removeClassName("connected");G.addClassName("notconnected");if($("accountOptions")){tr("account_settings_disconnect")}else{tr("autoshare_disconnect")}var N=G.down(".connect_text");if(N){N.innerHTML="You're not connected!"}var J=G.down(".connect_iconplacement");if(J){voidAttribute("uid",null);voidAttribute("uname",null);J.down("a")voidAttribute("href","");J.down("img")voidAttribute("src","")}var M=G.down(".button.connect");if(M){M.onclick=function(){return PBConnect[D].Login()};M.innerHTML="Connect"}var F=G.down(".connect_uploaddisabled");if(F){F.hide()}}if(this.isUploaddisabled){var I=jq(".uploaddisabledPanel .location_"+D);I.removeClass("connected");I.addClass("notconnected");I.find("#autoshare_"+D).attr("checked",false);I.find(".by").html("&nbsp;")}tr("share_disconnect");tr("share_"+D+"_disconnect")},autoshare:function(K){var J=K.memo;this.fromSharePanel=J.fromSharePanel;if(this.fromSharePanel){var L=J.ajaxParams}else{var I=$("autoshareform");var H=$$(".authService");var G=false;for(var F=0;F<H.length;F++){if(H[F].checked){G=true;switch(H[F].value){case"4":var D="messenger";break;case"3":var D="twitter";break;case"2":var D="facebook";break;case"1":var D="myspace";break}tr("post_uploaddisabled_share_"+D+"_total");tr("post_uploaddisabled_share_site_total")}}if(!G){var E=new PBMessage({title:"Please select a service to share to.",type:PBMessage.MESSAGE_TYPE.ERROR});this.fireMsg(E);return }if(this.getSelectedMediaSetCount()==0){var E=new PBMessage({title:"Please select an image or video to share.",type:PBMessage.MESSAGE_TYPE.ERROR});this.fireMsg(E);return }$("postuploaddisabledprogress").toggle();var L=I.serialize();tr("post_uploaddisabled_share_total")}var C="/share/autoshare/";new Ajax.Request(C,{method:"POST",parameters:L,evalJSON:"force",onSuccess:this.handleAutoShare.bindAsEventListener(this)})},handleAutoShare:function(D){if(D.responseJSON&&D.responseJSON.response.stat=="ok"){var C=new PBMessage({title:D.responseJSON.response.message.title,details:D.responseJSON.response.message.details,type:PBMessage.MESSAGE_TYPE.SUCCESS})}else{var C=new PBMessage({title:"There was a problem setting up your share.",type:PBMessage.MESSAGE_TYPE.ERROR})}if(this.fromSharePanel){document.fire(SharePanelController.EVENT.PROGRESS.DEACTIVATE);this.fireLBMsg(C)}else{$("postuploaddisabledprogress").toggle();this.fireMsg(C)}},createseturl:function(L){var I=L.memo;var J=I.mediaCnt;var C=$("setId");var K=this.getSelectedMediaSetCount();if(K==0){var E=new PBMessage({title:"Please select an image or video to share.",type:PBMessage.MESSAGE_TYPE.ERROR});this.fireMsg(E);return }var G="";var M="";var D=$$(".selectedMedia");for(var H=0;H<D.length;H++){var F=(H>0)?"&":"";if(D[H].checked){M+=F+"selectedMedia[]="+D[H].value}}if(C&&(C.value!="")&&(K==J)){G+="useset=1&setId="+C.value}else{G+=M}document.fire(PBLightbox.EVENT.ACTIVATE,{contentUrl:"/createset?"+G,cache:false})},emailset:function(C){if(this.getSelectedMediaSetCount()==0){var D=new PBMessage({title:"Please select an image or video to share.",type:PBMessage.MESSAGE_TYPE.ERROR});this.fireMsg(D)}else{document.fire(SharePanelController.EVENT.SHOW,C.memo.shareMemo)}},handleAutoShareSetting:function(D){var F=D.memo;var I=".smallloaddisabled."+F.sel;var C=(F.active)?1:0;var G=(F.fromPromo);if(F.siteId){var H={siteId:F.siteId,active:C}}else{var H={authId:F.authId,active:C}}var E=this;if(this.isAcctOptions){jq(I).show()}else{document.fire(PBLightbox.PBProgress.EVENT.ACTIVATE)}jq.post("/share/savesharesettings/",H,function(N){if(N.response.stat=="ok"){var L="#"+N.response.name+"_autoshare";var K=jq(L)[0];if(K){K.checked=(C==1)}var J=document.getElementById("autoshare_"+N.response.name);if(J){J.checked=(C==1)}if(E.isAcctOptions){jq(I).hide()}else{if(G){document.fire(PBLightbox.EVENT.DEACTIVATE)}else{document.fire(PBLightbox.PBProgress.EVENT.DEACTIVATE)}}}else{if(E.isAcctOptions){jq(I).hide();var M=new PBMessage({title:"Attention",details:N.response.message.title,type:PBMessage.MESSAGE_TYPE.ERROR});E.fireMsg(M)}else{document.fire(PBLightbox.PBProgress.EVENT.DEACTIVATE);var M=new PBMessage({title:"Attention",details:N.response.message.title,type:PBMessage.MESSAGE_TYPE.ERROR});E.fireLBMsg(M)}}},"json")},getSelectedMediaSetCount:function(){var D=$$(".selectedMedia");var C=0;for(var E=0;E<D.length;E++){if(D[E].checked){C++}}return C},setIsAcctOptions:function(C){this.isAcctOptions=C},setIsUploaddisabledPanel:function(C){this.isUploaddisabled=C},fireLBMsg:function(D){document.fire(PBLightbox.PBMessage.EVENT.NOTIFY,{message:D});if(photobucket.browser.isIE){var C=$("autosharectrl");if(C){C.hide();C.show()}}},fireMsg:function(C){document.fire(PBMessage.EVENT.NOTIFY,{message:C})}};var B={EVENT:{VERIFYAUTH:"AutoShareController:verifyauth",LOGOUT:"AutoShareController:logout",AUTOSHARE:"AutoShareController:autoshare",CREATESETURL:"AutoShareController:createseturl",EMAILSET:"AutoShareController:emailset",SAVESHARESETTING:"AutoShareController:savesharesetting"}};Controller.create("AutoShareController",A,B)})();